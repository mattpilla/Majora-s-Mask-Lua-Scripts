--"sotwarp.lua"
--For use in MM (U) on BizHawk 1.9.1
--Have save state 1 be over "Yes" on Song of Time
--Tests locked entrance + playing Song of Time

--Addresses:
local modSetter = 0x1F35BA
local scene = 0x3E6BC5
local newLoad = 0x3FF395
local exitSetter = 0x3FF39A

local file = io.open("mod_log.txt", "a")
local scenes = {"Southern Swamp (Clean)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","Grottos","Intro Map","(crash)","Magic Hags' Potion Shop","Majora","Beneath the Graveyard","Curiosity Shop","(crash)","(crash)","Mama's House / Barn","Honey & Darling's Shop","Mayor's Residence","Ikana Canyon","Pirates' Fortress (Outside)","Milk Bar","Stone Tower Temple","Treasure Chest Shop","Inverted Stone Tower Temple","Atop Clock Tower","(Deku Intro Area before Clock Tower)","Woodfall Temple","Snowhead Passage","Ikana Castle","Deku Flower Minigame","Woodfall Temple - Odolwa","Town Shooting Gallery","Snowhead Temple","Milk Road","Pirates' Fortress (Inside)","Swamp Shooting Gallery","Pinnacle Rock","Fairy's Fountain","Swamp Spider House","Oceanside Spider House","Astral Observatory","Woodfall Trial","Deku Palace","Mountain Smithy","Termina Field","Post Office","Marine Research Lab","Beneath the Graveyard (Dampe)","(crash)","Goron Shrine","Zora Hall","Trading Post","Romani Ranch","Stone Tower Temple - Twinmold","Great Bay Coast (Lab Area)","Great Bay Coast (Zora Area)","Lottery Shop","(crash)","Pirates' Fortress (Outside)","Fisherman's Hut","Goron Shop","Deku King's Chamber","Snowhead Trial","(Road to Swamp)","Doggy Racetrack","Cucco Shack","Ikana Graveyard","Snowhead Temple - Goht","Southern Swamp (Poisoned)","Woodfall Temple (Outside)","Great Bay Trial","Goron Village (Thawed)","Great Bay Temple","Waterfall Rapids","Beneath the Well","(Zora Band Member Rooms)","Goron Village (Frozen)","Goron Graveyard","Sakon's Hideout","Mountain Village (Frozen)","Ghost Hut","Deku Shrine","(Road to Ikana)","Swordsman's School","Music Box House","Ikana Castle Boss Room","Tourist Information","Stone Tower","Inverted Stone Tower","Mountain Village (Thawed)","(Road to Snowhead Temple)","Snowhead","(Road to Goron Village) (Frozen)","(Road to Goron Village) (Thawed)","Great Bay Temple - Gyorg","Secret Shrine","Stone Pot Inn","(Cutscene before Great Bay Temple)","Clock Tower (Inside)","Woods of Mystery","Lost Woods (Gain Control)","Ikana Trial","Moon","Bomb Shop","Giants' Chamber","Gorman Track","Goron Racetrack","East Clock Town","West Clock Town","North Clock Town","South Clock Town","Laundry Pool","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)","Laundry Pool","South Clock Town","North Clock Town","West Clock Town","East Clock Town","Goron Racetrack","Gorman Track","Giants' Chamber","Bomb Shop","Moon","Ikana Trial","Lost Woods (Gain Control)","Woods of Mystery","Clock Tower (Inside)","(Cutscene before Great Bay Temple)","Stone Pot Inn","Secret Shrine","Great Bay Temple - Gyorg","(Road to Goron Village) (Thawed)","(Road to Goron Village) (Frozen)","Snowhead","(Road to Snowhead Temple)","Mountain Village (Thawed)","Inverted Stone Tower","Stone Tower","Tourist Information","Ikana Castle Boss Room","Music Box House","Swordsman's School","(Road to Ikana)","Deku Shrine","Ghost Hut","Mountain Village (Frozen)","Sakon's Hideout","Goron Graveyard","Goron Village (Frozen)","(Zora Band Member Rooms)","Beneath the Well","Waterfall Rapids","Great Bay Temple","Goron Village (Thawed)","Great Bay Trial","Woodfall Temple (Outside)","Southern Swamp (Poisoned)","Snowhead Temple - Goht","Ikana Graveyard","Cucco Shack","Doggy Racetrack","(Road to Swamp)","Snowhead Trial","Deku King's Chamber","Goron Shop","Fisherman's Hut","Pirates' Fortress (Outside)","(crash)","Lottery Shop","Great Bay Coast (Zora Area)","Great Bay Coast (Lab Area)","Stone Tower Temple - Twinmold","Romani Ranch","Trading Post","Zora Hall","Goron Shrine","(crash)","Beneath the Graveyard (Dampe)","Marine Research Lab","Post Office","Termina Field","Mountain Smithy","Deku Palace","Woodfall Trial","Astral Observatory","Oceanside Spider House","Swamp Spider House","Fairy's Fountain","Pinnacle Rock","Swamp Shooting Gallery","Pirates' Fortress (Inside)","Milk Road","Snowhead Temple","Town Shooting Gallery","Woodfall Temple - Odolwa","Deku Flower Minigame","Ikana Castle","Snowhead Passage","Woodfall Temple","(Deku Intro Area before Clock Tower)","Atop Clock Tower","Inverted Stone Tower Temple","Treasure Chest Shop","Stone Tower Temple","Milk Bar","Pirates' Fortress (Outside)","Ikana Canyon","Mayor's Residence","Honey & Darling's Shop","Mama's House / Barn","(crash)","(crash)","Curiosity Shop","Beneath the Graveyard","Majora","Magic Hags' Potion Shop","(crash)","Intro Map","Grottos","(crash)","(crash)","(crash)","(crash)","(crash)","(crash)"}
local entrances = {0,16,512,1024,1536,1552,2048,2560,2576,3072,3088,3104,3120,3136,3152,3168,3184,3200,3216,3232,3584,3600,3616,3632,4096,5120,5136,5152,5168,5184,5200,5216,5232,5248,5264,5280,5296,5312,5328,5344,5360,5376,7168,7184,7200,7216,7232,7248,7264,7280,7296,8192,8208,8224,8240,8256,8272,8288,8304,8320,8336,8352,8368,8384,8400,8416,8704,8720,8736,8752,8768,8784,8800,8816,8832,8848,8864,8880,8896,8912,9216,9728,9744,10240,10256,10752,10768,11264,11280,11776,11792,11808,11824,11840,12288,12304,12320,12800,12816,13312,13328,13344,13360,13376,13392,13408,13824,13840,14336,14848,15360,15376,15872,15888,15904,15920,15936,15952,15968,16384,16400,16416,16432,16448,16464,16512,16528,16544,16560,16896,17408,17920,17936,17952,17968,17984,18000,18016,18032,18048,18064,18432,18944,19456,19472,19488,19968,20480,20496,20512,20528,20544,20560,20576,20592,20608,20624,20640,20992,21504,21520,21536,21552,21568,21584,21600,21616,21632,21648,21664,21680,21696,21712,21728,22016,22528,23040,23056,24064,24080,24096,24112,24576,24592,24608,24624,24640,24656,24672,24688,24704,25088,25600,25616,25632,25648,25664,25680,25696,25712,25728,25744,25760,25776,26112,26624,26640,26656,26672,26688,26704,26720,26736,26752,26768,26784,26800,26816,26832,27136,27152,27168,27184,27200,27216,27232,27248,27264,27280,27648,28672,28688,28704,28720,28736,28752,28768,29184,29696,30208,30224,30240,30256,30720,31232,31248,31744,32256,32272,32768,32784,32800,32816,32832,32848,33280,33792,33808,33824,33840,33856,33872,33888,33904,33920,33936,33952,34304,34320,34336,34352,34368,34816,34832,35328,35840,35856,36352,36368,36384,36400,36864,36880,37376,37392,37408,37424,37440,37456,37472,37888,37904,37920,37936,37952,38400,38416,38912,39424,39440,39456,39472,39488,39504,39520,39536,39552,39936,39952,39968,40448,40464,40960,40976,40992,41472,41984,42496,43008,43520,43536,43552,43568,44032,44048,44544,44560,44576,44592,44608,44624,44640,44656,44672,45056,45072,45568,45584,45600,45616,46080,46096,46112,46592,46608,46624,47104,47616,48128,48144,48160,48176,48192,48208,48640,49152,49168,49184,49200,49216,49232,49248,49664,50176,50688,51200,51712,52736,52752,52768,52784,52800,52816,53248,53264,53280,53760,53776,53792,53808,53824,53840,53856,53872,53888,53904,53920,53936,54272,54288,54304,54320,54336,54352,54368,54384,54400,54416,54784,54800,54816,54832,54848,54864,54880,54896,55296,55312,55328,55344,55360,55376,55392,55408,55424,55440,55456,55808,55824,56320}
 
for i, entrance in ipairs(entrances) do
	savestate.loadslot(1)
	frame = emu.framecount()
	memory.write_u16_be(exitSetter, entrance)
	memory.write_u16_be(modSetter, 65527)
	memory.writebyte(newLoad, 20)
	
	while emu.framecount() < frame + 250 do
		emu.frameadvance()
	end
	
	currScene = memory.readbyte(scene)
	
	message = entrance .. " -> " .. currScene .. " (" .. scenes[currScene+1] .. ")"
	print(message)
	file:write(message .."\n")
	file:flush()
	
	emu.frameadvance()
end